# 60% Работа с формами {#60}

Формы – это, пожалуй, один из самых нелюбимых элементов на странице – пока настроишь внешний вид, потом ещё проверь, что ввели нерадивые пользователи да выведи им информацию о допущенных ошибках, и в конце концов отправляешь на сервер данные с чувством облегчения от проделанной кропотливой работы. Так вот – о том, что поможет в этой самой работе я и буду рассказывать.

Для начала, стоит напомнить события с которыми чаще всего придётся работать:

change — изменение значения элемента

submit — отправка формы

В каких же случаях они нам помогут? Да всё просто – отслеживание change позволяет обрабатывать такие события как изменение selectbox&#039;а, или radiobutton&#039;а, что потребуется для динамического изменения формы. И самый простой пример тому – это на странице регистрации выбор страны, затем по выбранной стране должен быть подгружен список регионов, по региону – список городов и так далее. Отслеживание submit потребуется для проверки правильности заполнения формы, а так же для отправки формы посредством AJAX. Форму возьмём попроще:

&lt;form action=&quot;/save/&quot;&gt;

&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;Ivan&quot;/&gt;

&lt;select name=&quot;role&quot;&gt;

&lt;option&gt;User&lt;/option&gt;

&lt;option&gt;Admin&lt;/option&gt;

&lt;/select&gt;

&lt;input type=&quot;submit&quot;/&gt;

&lt;/form&gt;

А примеры будут идти в обратном порядке, вот отправка формы AJAX&#039;ом по ссылке из «action»:

$(&#039;form&#039;).submit(function(){

// чуть позже расскажу подробнее о AJAX

$.post(

$(this).attr(&#039;action&#039;), // ссылка куда отправляем данные

$(this).serialize() // данные формы

);

// отключаем действие по умолчанию

return false;

});

Вот и первый метод – «.serialize()» – он в ответе за «сбор» данных с формы в удобном для передачи данных формате:

name=Ivan&amp;role=Admin

Так же есть метод «.serializeArray()» – он собранные данные представляет в виде объекта:

[

{

name:&quot;name&quot;,

value:&quot;Ivan&quot;

},

{

name:&quot;role&quot;,

value:&quot;Admin&quot;

},

]

Теперь стоит добавить в данный код немного проверки данных:

$(&#039;form&#039;).submit(function(){

if ($(this).find(&#039;input[name=name]&#039;).val() == &#039;&#039;) {

alert(&#039;Введите имя пользователя&#039;);

return false;

}

// кусок кода с отправкой

// ...

});

Вот ещё один метод, который нам будет частенько нужен:

val() – получение значения первого элемента формы из выборки

val(_value_) – установка значение всем элементам формы из выборки

Данный метод отлично работает практически со всеми элементами формы, вот только с radiobutton&#039;ами установить значение таким образом не получится, тут потребуется небольшой workaround:

$(&#039;input[type=radio][name=choose][value=2]&#039;).prop(&#039;checked&#039;, true)

_Можно конечно же использовать и метод «.click()», дабы эмулировать выбор необходимо пункта, но это вызовет все обработчики события «click», что не желательно_

С checkbox&#039;ами чуть-чуть попроще:

$(&#039;input[name=check] &#039;).prop(&#039;checked&#039;, true)

Проверяем «чекнутость» простым скриптом:

$(&#039;input[name=check] &#039;).prop(&#039;checked&#039;)

// или чуть более наглядным способом

$(&#039;input[name=check] &#039;).is(&#039;:checked&#039;)

Проверять и отправлять форму AJAX&#039;ом теперь умеем, теперь осталось решить вопрос с динамическим изменением формы, и для этого у нас уже есть все необходимые знания, вот, к примеру, добавление выпадающего списка:

$(&#039;form&#039;).append(&#039;&lt;select name=&quot;some&quot;&gt;&lt;/select&gt;&#039;);

А если потребуется изменить список? Есть на все случаи жизни:

// возьмём список заранее, поберегу чернила

var $select = $(&#039;form select[name=Role]&#039;);

// добавить новый элемент в выпадающий список

$select.append(&#039;&lt;option&gt;Manager&lt;/option&gt;&#039;);

// выбрать необходимый элемент

$select.val(&#039;Value 1&#039;);

// или по порядковому номеру, начиная с 0

$select.find(&#039;option:eq(2)&#039;).prop(&#039;selected&#039;, true);

// очищаем список

$select.remove(&#039;option&#039;);

// преобразуем в multiple

// не забываем, что имя такого селекта, должно быть с [], т.е.

// myselect[], иначе сервер получит, лишь одно значение

$(&#039;select&#039;).attr(&#039;size&#039;,

$(&#039;select option&#039;).length

)

$(&#039;select&#039;).attr(&#039;multiple&#039;, true)

Хорошо, работать с формой теперь можем, осталось прикрутить более вменяемый вывод ошибок (да-да, за «alert()» да по рукам):

if ($(this).find(&#039;input[name=user]&#039;).val() == &#039;&#039;) {

$(this).find(&#039;input[name=user]&#039;)

.before(&#039;&lt;div class=&quot;error&quot;&gt;Введите имя&lt;/div&gt;&#039;);

return false;

}

При повторной отправки формы не забудьте убрать сообщения оставшиеся от предыдущей проверки:

$(this).find(&#039;.error&#039;).remove()

Теперь можно объединить кусочки кода и получить следующий вариант:

$(&#039;form&#039;).submit(function(){

// чистим ошибки

$(this).find(&#039;.error&#039;).remove();

// проверяем поля формы

if ($(this).find(&#039;input[type=name]&#039;).val() == &#039;&#039;) {

$(this).find(&#039;input[name=user]&#039;)

.before(&#039;&lt;div class=&quot;error&quot;&gt;Введите имя&lt;/div&gt;&#039;);

return false;

}

// всё хорошо – отправляем запрос на сервер

$.post(

$(this).attr(&#039;action&#039;), // ссылка куда отправляем данные

$(this).serialize() // данные формы

);

return false;

});

Теперь стоит вернуться к списку событий формы, и перечислить недостающие:

focus — фокус на элементе, для работы с данным событием так же есть «shorthand» метод «.focus()»; потребуется, если надо вывести подсказку к элементу формы при наведении

blur — фокус ушёл с элемента + метод «.blur()»; пригодится при валидации формы по мере заполнения полей

select — выбор текста в «textarea» и «input[type=text]» + метод «.select()»; если соберётесь разрабатывать свой WYSIWYG, то познакомитесь очень плотно

submit — отправка формы + метод «.submit()»; этот метод будете использовать частенько

_Примеры работы данных методов доступны на странице_ [_form.html_](http://anton.shevchuk.name/book/code/form.html)

Вот так мы и расправились с «ужасными» формами, возможно я ещё приведу несколько примеров из реальной жизни, но это будет уже в последующих версиях данного учебника :)