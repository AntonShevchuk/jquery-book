# 60% Работа с формами {#60}

Формы – это, пожалуй, один из самых нелюбимых элементов на странице – пока настроишь внешний вид, потом ещё проверь, что ввели нерадивые пользователи да выведи им информацию о допущенных ошибках, и, в конце концов, отправляешь на сервер данные с чувством облегчения от проделанной кропотливой работы. Так вот – о том, что поможет в этой самой работе, я и буду рассказывать.

Для начала, стоит напомнить события, с которыми чаще всего придётся работать:

`change` — изменение значения элемента

`submit` — отправка формы

В каких же случаях они нам помогут? Да всё просто – отслеживание `change` позволяет обрабатывать такие события, как изменение `<select>`, или `<input type="radio">`, что потребуется для динамического изменения формы. И самый простой пример тому – это выбор страны на странице регистрации, затем по выбранной стране должен быть подгружен список регионов, по региону – список городов и так далее. Отслеживание `submit` потребуется для проверки правильности заполнения формы, а также для отправки формы посредством AJAX. Форму возьмём попроще:

```html
<form action="/save/">
    <input type="text" name="name" value="Ivan"/>
    <select name="role">
        <option>User</option>
        <option>Admin</option>
    </select>
    <input type="submit"/>
</form>
```

А примеры будут идти в обратном порядке. Вот отправка формы через AJAX по ссылке из «action»:

```javascript
$('form').submit(function(){
    // вы же понимаете, о чём я тут толкую?
    $.post(
        $(this).attr('action'), // ссылка куда отправляем данные
        $(this).serialize()     // данные формы
    );
    // отключаем действие по умолчанию
    return false;
});
```

Вот и первый метод – «.serialize()» – он в ответе за «сбор» данных с формы в удобном для передачи данных формате:

```
name=Ivan&amp;role=Admin
```

Также есть метод «.serializeArray()» – он представляет собранные данные в виде объекта:

```json
[
  {
    "name":"name",
    "value":"Ivan"
  },
  {
    "name":"role",
    "value":"Admin"
  }
]
```

Теперь стоит добавить в данный код немного проверки данных:

```javascript
$('form').submit(function(){
    if ($(this).find('input[name=name]').val() == '') {
        alert('Введите имя пользователя');
        return false;
    }
    // кусок кода с отправкой данных
    // ...
});
```

Вот ещё один метод, который нам будет частенько нужен:

`val()` – получение значения первого элемента формы из выборки

`val(value)` – установка значения всем элементам формы из выборки

Данный метод отлично работает практически со всеми элементами формы, вот только с radiobutton установить значение таким образом не получится, тут потребуется небольшой workaround:

```javascript
$('input[type=radio][name=choose][value=2]').prop('checked', true)
```

> _Можно, конечно же, использовать и метод «.click()», дабы эмулировать выбор необходимого пункта, но это вызовет все обработчики события «click», что не желательно._

С checkbox чуть-чуть попроще:

```javascript
$('input[name=check] ').prop('checked', true)
```

Проверяем «чекнутость» простым скриптом:

```javascript
$('input[name=check] ').prop('checked')
// или чуть более наглядным способом
$('input[name=check] ').is(':checked')
```

Проверять и отправлять форму через AJAX теперь умеем, осталось решить вопрос с динамическим изменением формы. И для этого у нас уже есть все необходимые знания. Вот, к примеру, добавление выпадающего списка:

```javascript
$('form').append('<select name="some"></select>');
```

А если потребуется изменить список? Есть на все случаи жизни:

```javascript
// возьмём список заранее, поберегу чернила
var $select = $('form select[name=Role]');
// добавить новый элемент в выпадающий список
$select.append('<option>Manager</option>');
// выбрать необходимый элемент
$select.val('Value 1');
// или по порядковому номеру, начиная с 0
$select.find('option:eq(2)').prop('selected', true);
// очищаем список
$select.remove('option');
// преобразуем в multiple
// не забываем, что имя такого селекта должно быть с [], т.е.
// myselect[], иначе сервер получит лишь одно значение
$('select').attr('size',
    $('select option').length
)

$('select').attr('multiple', true)
```

Хорошо, работать с формой теперь можем, осталось прикрутить более вменяемый вывод ошибок (да-да, за «alert()» бьём по рукам):

```javascript
if ($(this).find('input[name=user]').val() == '') {
    $(this).find('input[name=user]')
      .before('<div class="error">Введите имя</div>');
    return false;
}
```

При повторной отправке формы не забудьте убрать сообщения, оставшиеся от предыдущей проверки:

```javascript
$(this).find('.error').remove()
```

Теперь можно объединить кусочки кода и получить следующий вариант:

```javascript
$('form').submit(function(){
    // чистим ошибки
    $(this).find('.error').remove();
    // проверяем поля формы
    if ($(this).find('input[type=name]').val() == '') {
        $(this).find('input[name=user]')
          .before('<div class="error">Введите имя</div>');
        return false;
    }
    // всё хорошо – отправляем запрос на сервер
    $.post(
        $(this).attr('action'), // ссылка куда отправляем данные
        $(this).serialize()     // данные формы
    );
    // отключаем действие по умолчанию
    return false;
});
```

Теперь стоит вернуться к списку событий формы и перечислить недостающие:

`focus` — фокус на элементе, для работы с данным событием так же есть «shorthand» метод «.focus()»; потребуется, если надо вывести подсказку к элементу формы при наведении

`blur` — фокус ушёл с элемента + метод «.blur()»; пригодится при валидации формы по мере заполнения полей

`select` — выбор текста в «textarea» и «input[type=text]» + метод «.select()»; если соберётесь разрабатывать свой WYSIWYG, то познакомитесь очень плотно

`submit` — отправка формы + метод «.submit()»; этот метод будете использовать частенько

> _Примеры работы данных методов доступны на странице [form.html](http://anton.shevchuk.name/book/code/form.html)._

Вот так мы и расправились с «ужасными» формами. Возможно, я ещё приведу несколько примеров из реальной жизни, но это будет уже в последующих версиях данного учебника :)
