## JSONP {#jsonp}

JSONP – это наш старый знакомый JSON с прослойкой в виде callback функции О_о. Да ладно, давайте на примерах, вот как у нас выглядит ответ сервера в формате JSON:

```json
{
  "note": {
    "time":"2012.09.21 13:12:42",
    "text":"Рассказать зачем нужен JSONP"
  }
}
```

Хорошо, когда у нас эти данные приходят с нашего сервера – обработаем, и всё будет чики-пики, но а если нам потребуется заполучить данные с другого сервера, то политика безопасности в браузерах не позволит отправить XMLHTTPRequest на другой сервер, и надо уже будет что-то придумывать. Можно чуть-чуть напрячься и вспомнить, что подключать JavaScript с другого сервера то мы можем, и он будет выполнен. Вот она – зацепка-то, а если подключаемый скрипт будет содержать вызов нашей функции с подготовленными данными – то это уже что-то:

```javascript
alertMe({
  "note":{
    "time":"2012.09.21 13:13:13",
    "text":"Каков же профит от использования JSONP?"
  }
})
```

Таким образом, описав в своём коде функцию «alertMe()» мы сможем обработать данные с удаленного сервера. Зачастую, сервера ловят параметр «callback» или «jsonp», и используют его как имя функции обёртки:

```html
<script type="text/javascript" src="http://domain.com/getUsers/?callback=alertMe"></script>
```

Ну это было предыстория, теперь вернёмся к jQuery и методу «.ajax()»:

```javascript
$.ajax({
  url: "http://domain.com/getUsers/?callback=?", // указываем URL
  dataType: "jsonp",
  success: function (data) {
    // обрабатываем данные
  }
});
```

В запрашиваемом URL наблюдательный читатель заметит незаконченную структуру «callback=?», так вот вместо «?» будет подставлено имя ново сгенерированной функции, внутри которой будет осуществляться вызов функции «success()». Вместо этой прокси-функции можно использовать и свою функцию, достаточно указать её имя в качестве параметра «jsonpCallback» при вызове «$.ajax()». Оба этих подхода есть в примере [ajax.jsonp.html](http://anton.shevchuk.name/book/code/ajax.jsonp.html).

_А ещё стоит упомянуть, что можно указать как обзывается callback-параметр используя параметр «jsonp», таким образом указав «jsonp:"my"» в URL будет добавлена структура «my=?»_

На данный момент достаточно много сервисов предоставляют API с поддержкой JSONP:

* Yahoo – поиск и [большинство сервисов](https://developer.yahoo.com/javascript/json.html)
* [Flickr](http://www.flickr.com/services/api/) – работа с поиском данного сервиса
* [MediaWiki](http://en.wikipedia.org/w/api.php) – соответственно и производные – Wikipedia, Wiktionary
* [CNET](http://api.cnet.com/dashboard.html) – поиск по новостному порталу

Использование подобного подхода позволяет обходить ограничения накладываемые сервисами на количество запросов с одного IP, плюс не грузит сервер дополнительной работой по проксированию запросов от пользователя к сервисам.

К сожалению, многие провайдеры сервисов (такие как Google) отказывают от предоставления доступа к их API с использованием JSONP.
