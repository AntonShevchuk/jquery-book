## JSONP {#jsonp}

JSONP – это наш старый знакомый JSON с прослойкой в виде callback функции О_о. Да ладно, давайте на примерах, вот как у нас выглядит ответ сервера в формате JSON:

_{_

&quot;note&quot;_: {_

&quot;time&quot;_:_&quot;2012.09.21 13:12:42&quot;_,_

&quot;text&quot;_:_&quot;Рассказать зачем нужен JSONP&quot;

_}_

_}_

Хорошо, когда у нас эти данные приходят с нашего сервера – обработаем, и всё будет чики-пики, но а если нам потребуется заполучить данные с другого сервера, то политика безопасности в браузерах не позволит отправить XMLHTTPRequest на другой сервер, и надо уже будет что-то придумывать. Можно чуть-чуть напрячься и вспомнить, что подключать JavaScript с другого сервера то мы можем, и он будет выполнен. Вот она – зацепка-то, а если подключаемый скрипт будет содержать вызов нашей функции с подготовленными данными – то это уже что-то:

alertMe_({_

&quot;note&quot;_: {_

&quot;time&quot;_:_&quot;2012.09.21 13:13:13&quot;_,_

&quot;text&quot;_:_&quot;Каков же профит от использования JSONP?&quot;

_}_

_})_

Таким образом, описав в своём коде функцию «alertMe()» мы сможем обработать данные с удаленного сервера. Зачастую, сервера ловят параметр «callback» или «jsonp», и используют его как имя функции обёртки:

&lt;script type=&quot;text/javascript&quot;

src=&quot;http://domain.com/getUsers/?callback=alertMe&quot;&gt;

&lt;/script&gt;

Ну это было предыстория, теперь вернёмся к jQuery и методу «.ajax()»:

_$._ajax_({_

_url:_ &quot;http://domain.com/getUsers/?callback=?&quot;_,_ // указываем URL

_dataType:_ &quot;jsonp&quot;_,_

_success:_ function _(data) {_

_// обрабатываем данные_

_}_

_});_

В запрашиваемом URL наблюдательный читатель заметит незаконченную структуру «callback=?», так вот вместо «?» будет подставлено имя ново сгенерированной функции, внутри которой будет осуществляться вызов функции «success()». Вместо этой прокси-функции можно использовать и свою функцию, достаточно указать её имя в качестве параметра «jsonpCallback» при вызове «$.ajax()». Оба этих подхода есть в примере [ajax.jsonp.html](http://anton.shevchuk.name/book/code/ajax.jsonp.html).

_А ещё стоит упомянуть, что можно указать как обзывается callback-параметр используя параметр «jsonp», таким образом указав «jsonp:&quot;my&quot;» в URL будет добавлена структура «my=?»_

На данный момент достаточно много сервисов предоставляют API с поддержкой JSONP:

*   Yahoo – поиск и [большинство сервисов](https://developer.yahoo.com/javascript/json.html)
*   [Flickr](http://www.flickr.com/services/api/) – работа с поиском данного сервиса
*   [MediaWiki](http://en.wikipedia.org/w/api.php) – соответственно и производные – Wikipedia, Wiktionary
*   [CNET](http://api.cnet.com/dashboard.html) – поиск по новостному порталу

Использование подобного подхода позволяет обходить ограничения накладываемые сервисами на количество запросов с одного IP, плюс не грузит сервер дополнительной работой по проксированию запросов от пользователя к сервисам.

К сожалению, многие провайдеры сервисов (такие как Google) отказывают от предоставления доступа к их API с использованием JSONP.