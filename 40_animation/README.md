# 40% Анимация {#40}

Библиотека jQuery позволяет очень легко анимировать DOM-элементы, для этого предусмотрено несколько функций. Но обо всём по порядку. Начнём с простых «.hide()» и «.show()», эти два метода, соответственно, скрывают либо отображают элементы:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// скроем все картинки
$('img').hide();
```

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// теперь вернём их на место
$('img').show();
```

{% jqbFrame "animation", "../code/animation.html", height="400px" %}
{% sticky %}
{% reload %}
{% endjqbFrame %}

Данные вызовы оперируют лишь CSS-атрибутом «display» и переключают его из текущего состояния в «none» и обратно. В качестве первого параметра можно задать скорость анимации, для этого можно использовать одно из зарезервированных слов «slow» или «fast», либо же указывать скорость в миллисекундах (1000 мс = 1 сек):

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// медленно спускаемся с горы и… скрываем все картинки
// **slow == 600**
// **fast == 200**
$('img').hide('slow');
```

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// теперь вернём их на место, чуть быстрее
$('img').show(400);
```

В таком случае исчезновение элементов будет сопровождаться изменением атрибутов «width», «height», «opacity» и прочих. В довесок к этим двум методам есть ещё метод «.toggle()», который работает как переключатель «hide → show» или «show → hide»:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// запустите пару раз
$('img').toggle();
```

Дальше – больше, вторым параметром в приведенных методах может быть callback-функция – она будет выполнена по окончании анимации элементов:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// скрываем все картинки
$('img').hide('slow', function(){
    // опосля отображаем alert
    alert("Images was hidden");
});
```

> _Анимацию таких атрибутов как «height», «width» и «opacity» видно невооружённым взглядом, в действительности же это далеко не всё. Заглянув внутрь jQuery, можно увидеть, что так же изменяются внутренние и внешние отступы – «padding» и «margin» – так что не стоит об этом забывать._

Идём дальше – у нас на очереди набор методов из семейства slide: «.slideUp()», «.slideDown()» и «.slideToggle()». Их поведение схоже с предыдущими функциями, но анимация будет затрагивать лишь высоту блоков:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// скроем все картинки
$('img').slideUp();
```

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// теперь вернём их на место
$('img').slideDown();
```

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// поменяем значение
$('img').slideToggle();
```

Прежде, чем перейти к десерту, упомяну семейство функций fade — они манипулируют лишь атрибутом «opacity»:

{% jqbScript "#animation" %}$('img').fadeIn(){% endjqbScript %} – изменяет «opacity» от 0 до предыдущего значения

{% jqbScript "#animation" %}$('img').fadeOut(){% endjqbScript %}– изменяет «opacity» от текущего до 0

{% jqbScript "#animation" %}$('img').fadeToggle(){% endjqbScript %} – переключатель между «In» и «Out»

{% jqbScript "#animation" %}$('img').fadeTo("slow", 0.5){% endjqbScript %} – изменяет значение «opacity» до требуемого значения

А теперь самое сладкое – все эффекты анимации в jQuery крутятся вокруг метода «.animate()». Данная функция берёт один или несколько CSS-свойств элемента и изменяет их от исходного до заданного за N-ое количество итераций (количество итераций зависит от указанного времени, но не реже одной итерации в 13мс, если я правильно накопал это значение). Ну что же, от слов к делу, попробуем реализовать функции «.fadeIn()» и «.fadeout()» с помощью «.animate()» :

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// fadeOut()
$('img').animate({
    'opacity': 'hide'
})
```

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// fadeIn()
$('img').animate({
    'opacity': 'show'
})
```

Всё просто. Давайте-ка теперь усложним задачу – изменим размер блоков и прозрачность:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// значения указанных свойств будут плавно изменяться
// от текущих до заданных
$('img').animate({
    'opacity': 0.5,
    'height': '100px',
    'width': '100px'
})
```

Как видите, тоже несложно. Теперь попробуем отталкиваться от текущих значений, а не задавать необходимые:

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// изменяем, шаг за шагом
$('img').animate({
    'opacity': '+=0.1',
    'height': '+=12px',
    'width': '+=20px'
})
```

Поигрались и хватит, пора усложнить вам жизнь. У метода «.animate()» может быть более одного параметра, и пора приступить к их разбору. Набор параметров может быть разным; приведу первый, тот, что попроще:

`properties` – CSS-свойства – с этим мы уже познакомились

`duration` – скорость анимации, уже упоминалась ранее, указывается в миллисекундах, или используя ключевые слова «fast» или «slow»

`easing` – указываем, какую функцию будем использовать для изменения значений

`complete` – функция, которая будет вызвана после окончания анимации

Из приведённых параметров нам только «easing» не встречался ранее – я его берёг для данного момента. Этот параметр указывает, какая функция будет использоваться для процесса анимации значений. Это могут быть линейные, квадратичные, кубические и любые другие функции. «Из коробки» мы можем выбрать лишь между «linear»:

<div style="width:50%">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="-8 -8 140 140">
        <line x1="0" x2="0" y1="0" y2="120"></line>
        <text x="2" y="6">x</text>
        <line x1="0" x2="120" y1="120" y2="120"></line>
        <text x="115" y="115">t</text>
        <path d="M0,120 L120.0,0.0"></path>
    </svg>
</div>
 
и «swing»:

<div style="width:50%">
    <svg id="swing" xmlns="http://www.w3.org/2000/svg" viewBox="-8 -8 140 140">
        <line x1="0" x2="0" y1="0" y2="120"></line>
        <text x="2" y="6">x</text>
        <line x1="0" x2="120" y1="120" y2="120"></line>
        <text x="115" y="115">t</text>
        <path d="M0,120 L0,120 0.118,117.6 0.473,115.1 1.062,112.8 1.885,110.4 2.936,108 4.213,105.6 5.710,103.2 7.421,100.8 9.340,98.4 11.45,96 13.76,93.60 16.26,91.2 18.92,88.8 21.75,86.39 24.73,84 27.85,81.6 31.09,79.19 34.45,76.79 37.91,74.39 41.45,71.99 45.07,69.59 48.75,67.19 52.48,64.79 56.23,62.39 60.00,59.99 63.76,57.59 67.51,55.19 71.24,52.79 74.92,50.39 78.54,47.99 82.08,45.59 85.54,43.19 88.90,40.79 92.14,38.39 95.26,35.99 98.24,33.59 101.0,31.19 103.7,28.79 106.2,26.39 108.5,23.99 110.6,21.59 112.5,19.19 114.2,16.79 115.7,14.39 117.0,11.99 118.1,9.599 118.9,7.199 119.5,4.799 119.8,2.399 120.0,0.0"></path>
    </svg>
</div>

Заглянув в код jQuery, мы легко найдём соответствующий код:

```javascript
jQuery.easing = {
	linear: function( p ) {
		return p;
	},
	swing: function( p ) {
		return 0.5 - Math.cos( p * Math.PI ) / 2;
	},
	_default: "swing"
};
```

> _`p` – коэффициент прохождения анимации, изменяется от 0 до 1._

> _Сложно? Хотите больше и сразу? Тогда ищите easing plugin на странице [http://gsgd.co.uk/sandbox/jquery/easing/](http://gsgd.co.uk/sandbox/jquery/easing/), он действительно из разряда «must have»._

> _В качестве путеводителя по easing-функциям можете использовать страничку [http://easings.net/](http://easings.net/)._

Но давайте вернёмся к методу «.animate()», который в качестве параметров может принимать ещё один набор параметров, который уже не будет казаться таким простым:

`properties` – CSS-свойства (уже было)

`options` – целый набор возможностей, часть которых уже описывалась ранее:
  
* `duration` – скорость анимации
* `easing` – функция («linear» или «swing»)
* `queue` – флаг/параметр очереди; чуть позже опишу подробнее
* `specialEasing` – хэш, в котором можно описать, какую именно easing-функцию следует использовать для изменения определённых параметров
* `step` – функция, которая будет вызвана на каждом шаге анимации для каждого CSS-свойства; о ней расскажу чуть ниже
* `complete` – функция, которая будет вызвана после окончания анимации
* `start` – функция, которая будет вызвана до начала анимации
* `progress` – функция, которая будет вызвана на каждом шаге, но только единождый для элемента, вне зависимости от количества CSS-свойств
* `done` – функция, которая будет вызвана после успешного окончания анимации
* `fail` – функция, которая будет вызвана после неудачного окончания анимации
* `always` – функция, которая будет вызвана после окончания анимации при любом исходе

> _Поддержка последних пяти функций добавлена в версии 1.8. Данный [релиз jQuery ознаменовался](https://blog.jquery.com/2012/08/09/jquery-1-8-released/) глобальным рефакторингом анимации и переездом на Deferred._

{% jqbRun "#animation" %}{% endjqbRun %}
```javascript
// изменяем высоту и ширину
$('img').animate({
    'height': '+=10px',
    'width': '+=10px'
}, {
  'start':    () => console.log('start'),
  'progress': () => console.log('progress'),
  'done':     () => console.log('done'),
  'fail':     () => console.log('fail'),
  'always':   () => console.log('always')
})
```

> _Результат выполнения данного кода доступен в консоли._
